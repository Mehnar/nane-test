(function(e){function t(t){for(var r,a,c=t[0],u=t[1],s=t[2],m=0,l=[];m<c.length;m++)a=c[m],Object.prototype.hasOwnProperty.call(o,a)&&o[a]&&l.push(o[a][0]),o[a]=0;for(r in u)Object.prototype.hasOwnProperty.call(u,r)&&(e[r]=u[r]);d&&d(t);while(l.length)l.shift()();return i.push.apply(i,s||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],r=!0,a=1;a<n.length;a++){var c=n[a];0!==o[c]&&(r=!1)}r&&(i.splice(t--,1),e=u(u.s=n[0]))}return e}var r={},a={app:0},o={app:0},i=[];function c(e){return u.p+"js/"+({"Empty~about":"Empty~about",Empty:"Empty","Login~New~about":"Login~New~about",about:"about",Login:"Login",New:"New"}[e]||e)+"."+{"Empty~about":"246f8f81",Empty:"d4de2850","Login~New~about":"08d3d800",about:"a7927509",Login:"079c4985",New:"317856fb"}[e]+".js"}function u(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,u),n.l=!0,n.exports}u.e=function(e){var t=[],n={"Empty~about":1,"Login~New~about":1,about:1,Login:1,New:1};a[e]?t.push(a[e]):0!==a[e]&&n[e]&&t.push(a[e]=new Promise((function(t,n){for(var r="css/"+({"Empty~about":"Empty~about",Empty:"Empty","Login~New~about":"Login~New~about",about:"about",Login:"Login",New:"New"}[e]||e)+"."+{"Empty~about":"1a31b591",Empty:"31d6cfe0","Login~New~about":"c436f2d5",about:"d7a89ab5",Login:"d705e678",New:"747c9294"}[e]+".css",o=u.p+r,i=document.getElementsByTagName("link"),c=0;c<i.length;c++){var s=i[c],m=s.getAttribute("data-href")||s.getAttribute("href");if("stylesheet"===s.rel&&(m===r||m===o))return t()}var l=document.getElementsByTagName("style");for(c=0;c<l.length;c++){s=l[c],m=s.getAttribute("data-href");if(m===r||m===o)return t()}var d=document.createElement("link");d.rel="stylesheet",d.type="text/css",d.onload=t,d.onerror=function(t){var r=t&&t.target&&t.target.src||o,i=new Error("Loading CSS chunk "+e+" failed.\n("+r+")");i.code="CSS_CHUNK_LOAD_FAILED",i.request=r,delete a[e],d.parentNode.removeChild(d),n(i)},d.href=o;var S=document.getElementsByTagName("head")[0];S.appendChild(d)})).then((function(){a[e]=0})));var r=o[e];if(0!==r)if(r)t.push(r[2]);else{var i=new Promise((function(t,n){r=o[e]=[t,n]}));t.push(r[2]=i);var s,m=document.createElement("script");m.charset="utf-8",m.timeout=120,u.nc&&m.setAttribute("nonce",u.nc),m.src=c(e);var l=new Error;s=function(t){m.onerror=m.onload=null,clearTimeout(d);var n=o[e];if(0!==n){if(n){var r=t&&("load"===t.type?"missing":t.type),a=t&&t.target&&t.target.src;l.message="Loading chunk "+e+" failed.\n("+r+": "+a+")",l.name="ChunkLoadError",l.type=r,l.request=a,n[1](l)}o[e]=void 0}};var d=setTimeout((function(){s({type:"timeout",target:m})}),12e4);m.onerror=m.onload=s,document.head.appendChild(m)}return Promise.all(t)},u.m=e,u.c=r,u.d=function(e,t,n){u.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},u.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},u.t=function(e,t){if(1&t&&(e=u(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(u.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)u.d(n,r,function(t){return e[t]}.bind(null,r));return n},u.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return u.d(t,"a",t),t},u.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},u.p="/nane-test/",u.oe=function(e){throw console.error(e),e};var s=window["webpackJsonp"]=window["webpackJsonp"]||[],m=s.push.bind(s);s.push=t,s=s.slice();for(var l=0;l<s.length;l++)t(s[l]);var d=m;i.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"1f8c":function(e,t,n){"use strict";n("45b9")},"45b9":function(e,t,n){},"56d7":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var r=n("2b0e"),a=n("6e87"),o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-app",[n("v-app-bar",{attrs:{app:"",color:"primary",dark:"","clipped-left":""}},[n("v-app-bar-nav-icon",{on:{click:function(t){t.stopPropagation(),e.drawer=!e.drawer}}})],1),n("navigation",{attrs:{drawer:e.drawer},on:{"update:drawer":function(t){e.drawer=t}}}),n("v-main",[n("router-view")],1)],1)},i=[],c=n("5530"),u=n("2f62"),s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-navigation-drawer",{attrs:{"mobile-breakpoint":"xs",width:"300",fixed:"",app:"",clipped:""},model:{value:e.drawerValue,callback:function(t){e.drawerValue=t},expression:"drawerValue"}},[n("v-sheet",{staticClass:"pa-4",attrs:{color:"d-flex justify-space-between grey lighten-4"}},[e.login?[n("span",[e._v(" "+e._s(e.login)+" ")]),n("v-btn",{on:{click:e.logout}},[e._v(" Logout ")])]:n("v-btn",{attrs:{to:{name:"Login"},link:""}},[e._v(" Login ")])],2),n("v-divider"),e.isRoomsLoading?n("div",{staticClass:"text-center mt-3"},[e.isRoomsLoading?n("v-progress-circular",{attrs:{indeterminate:"",color:"primary"}}):e._e()],1):n("v-list",[e._l(e.rooms,(function(t){return n("v-list-item",{key:t.name,attrs:{to:{name:"Chat",params:{name:t.name}},link:""}},[n("v-list-item-content",[n("v-list-item-title",{staticClass:"d-flex justify-space-between"},[e._v(" "+e._s(t.name)+" "),n("span",{staticClass:"date"},[e._v(" "+e._s(t.last_message.createdFormatted)+" ")])]),n("v-list-item-subtitle",[n("b",[e._v(" "+e._s(t.last_message.sender.username)+": ")]),n("span",[e._v(" "+e._s(t.last_message.text)+" ")])])],1),t.count>0?n("v-list-item-icon",[n("span",{staticClass:"number-text"},[e._v(e._s(t.count)+" ")])]):e._e()],1)})),n("v-list-item",{attrs:{to:{name:"New"},link:"",exact:""}},[n("v-list-item-content",[n("v-list-item-title",[e._v("Create new room")])],1),n("v-list-item-icon",[n("v-icon",[e._v("mdi-message-plus-outline")])],1)],1)],2)],1)},m=[],l={props:{drawer:{type:Boolean,default:null}},computed:Object(c["a"])(Object(c["a"])({drawerValue:{get:function(){return this.drawer},set:function(e){this.$emit("update:drawer",e)}}},Object(u["c"])({rooms:a["ROOMS_SORTED_GET"]})),Object(u["d"])(["isRoomsLoading","login"])),methods:Object(c["a"])({},Object(u["b"])({logout:a["LOGOUT"]}))},d=l,S=(n("1f8c"),n("2877")),p=n("6544"),E=n.n(p),f=n("8336"),O=n("ce7e"),_=n("132d"),b=n("8860"),g=n("da13"),v=n("5d23"),T=n("34c3"),h=n("f774"),w=n("490a"),R=n("8dd9"),N=Object(S["a"])(d,s,m,!1,null,"899133b2",null),j=N.exports;E()(N,{VBtn:f["a"],VDivider:O["a"],VIcon:_["a"],VList:b["a"],VListItem:g["a"],VListItemContent:v["a"],VListItemIcon:T["a"],VListItemSubtitle:v["b"],VListItemTitle:v["c"],VNavigationDrawer:h["a"],VProgressCircular:w["a"],VSheet:R["a"]});var L={name:"App",components:{Navigation:j},data:function(){return{drawer:null}},computed:Object(c["a"])({},Object(u["d"])(["login"])),created:function(){this.login||this.$router.push({name:"default"}),this.$store.dispatch(this.$types.INIT_CONNECT)}},y=L,G=n("7496"),I=n("40dc"),M=n("5bc1"),C=n("f6c4"),A=Object(S["a"])(y,o,i,!1,null,null,null),k=A.exports;E()(A,{VApp:G["a"],VAppBar:I["a"],VAppBarNavIcon:M["a"],VMain:C["a"]});n("d3b7"),n("3ca3"),n("ddb0");var x,D,F,V=n("0e44"),P=n("ade3"),H=(x={},Object(P["a"])(x,a["LOGIN_SET"],(function(e,t){e.login=t})),Object(P["a"])(x,a["ROOMS_SET"],(function(e,t){e.rooms=t})),Object(P["a"])(x,a["SOCKET_SET"],(function(e,t){e.socket=t})),Object(P["a"])(x,a["SOCKET_ERROR_SET"],(function(e,t){e.isSocketError=t})),Object(P["a"])(x,a["ROOMS_IS_LOADING_SET"],(function(e,t){e.isRoomsLoading=t})),Object(P["a"])(x,a["ROOM_CURRENT_SET"],(function(e,t){e.currentRoom=t})),Object(P["a"])(x,a["MESSAGES_SET"],(function(e,t){e.messages=t})),Object(P["a"])(x,a["MESSAGES_SENDING_SET"],(function(e,t){e.messagesSending=t})),Object(P["a"])(x,a["MESSAGES_IS_LOADING_SET"],(function(e,t){e.isMessagesLoading=t})),x),K=n("2909"),U=n("1da1"),$=(n("99af"),n("d81d"),n("b0c0"),n("7db0"),n("4de4"),n("96cf"),n("8a77")),q=n("d4ec"),B=n("bee2"),J=n("bc3a"),W=n.n(J),z=function(){function e(t){Object(q["a"])(this,e),this.client=W.a.create({baseURL:t,mode:"cors",headers:{Accept:"application/json","Content-Type":"application/json; charset=utf-8"},withCredentials:!1,credentials:"include"})}return Object(B["a"])(e,[{key:"getRooms",value:function(){var e=Object(U["a"])(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.client.get("rooms");case 2:return t=e.sent,n=t.data.result,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getRoomHistory",value:function(){var e=Object(U["a"])(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.client.get("rooms/".concat(t,"/history"));case 2:return n=e.sent,r=n.data.result,e.abrupt("return",r);case 5:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()}]),e}(),Q=new z("https://nane.tada.team/api/"),X=(D={},Object(P["a"])(D,a["LOGIN"],(function(e,t){return Object(U["a"])(regeneratorRuntime.mark((function n(){var r,o;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:r=e.commit,o=e.dispatch,r(a["LOGIN_SET"],t),o(a["INIT_CONNECT"]),ie.push({name:"default"});case 4:case"end":return n.stop()}}),n)})))()})),Object(P["a"])(D,a["LOGOUT"],(function(e){return Object(U["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:n=e.commit,n(a["LOGIN_SET"],null),n(a["SOCKET_SET"],null),ie.push({name:"default"}).catch((function(){}));case 4:case"end":return t.stop()}}),t)})))()})),Object(P["a"])(D,a["INIT_CONNECT"],(function(e){return Object(U["a"])(regeneratorRuntime.mark((function t(){var n,r,o,i,u,s,m,l,d;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(d=function(e){o(a["SOCKET_ERROR_SET"],!0),setTimeout((function(){return r(a["INIT_CONNECT"])}),2e3),console.log(e)},l=function(){return l=Object(U["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,r(a["ROOMS_LIST_FETCH"]);case 2:if(!n.isSocketError||!n.currentRoom){e.next=5;break}return e.next=5,r(a["MESSAGES_FETCH"],n.currentRoom);case 5:return e.next=7,Promise.all(n.messagesSending.map((function(e){return r(a["MESSAGE_SEND"],e)})));case 7:o(a["SOCKET_ERROR_SET"],!1);case 8:case"end":return e.stop()}}),e)}))),l.apply(this,arguments)},m=function(){return l.apply(this,arguments)},s=function(e){var t=JSON.parse(e.data);t.room===n.currentRoom?(o(a["MESSAGES_SET"],[].concat(Object(K["a"])(n.messages),[t])),o(a["ROOMS_SET"],n.rooms.map((function(e){return e.name===t.room?Object(c["a"])(Object(c["a"])({},e),{},{last_message:t}):e})))):n.rooms.find((function(e){return e.name===t.room}))?o(a["ROOMS_SET"],n.rooms.map((function(e){return e.name===t.room?Object(c["a"])(Object(c["a"])({},e),{},{last_message:t,count:e.count+1}):e}))):o(a["ROOMS_SET"],[].concat(Object(K["a"])(n.rooms),[{name:t.room,last_message:t,count:0}]))},n=e.state,r=e.dispatch,o=e.commit,o(a["SOCKET_SET"],null),n.login){t.next=9;break}return r(a["ROOMS_LIST_FETCH"]),t.abrupt("return");case 9:i="".concat("wss://nane.tada.team/ws","?username=").concat(encodeURIComponent(n.login)),u=new WebSocket(i),u.addEventListener("message",s),u.addEventListener("open",m),u.addEventListener("close",d),o(a["SOCKET_SET"],u);case 15:case"end":return t.stop()}}),t)})))()})),Object(P["a"])(D,a["MESSAGE_SEND"],(function(e,t){return Object(U["a"])(regeneratorRuntime.mark((function n(){var r,o,i,c,u,s,m;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(r=e.state,o=e.commit,i=t.room,c=t.text,u=t.id,r.socket){n.next=4;break}return n.abrupt("return",Promise.reject());case 4:return s={id:u||Object($["a"])(),room:i,text:c},m=!!r.messagesSending.find((function(e){return e.id===s.id})),i!==r.currentRoom||m||o(a["MESSAGES_SENDING_SET"],[].concat(Object(K["a"])(r.messagesSending),[s])),n.abrupt("return",new Promise((function(e,t){function n(){r.socket.removeEventListener("message",i),r.socket.removeEventListener("close",c),r.socket.removeEventListener("error",c)}function i(t){var i=JSON.parse(t.data);i.id===s.id&&(o(a["MESSAGES_SENDING_SET"],r.messagesSending.filter((function(e){return e.id!==s.id}))),n(),console.log("resolve"),e())}function c(){n(),console.log("reject"),t()}r.socket.addEventListener("message",i),r.socket.addEventListener("close",c),r.socket.addEventListener("error",c),r.socket.send(JSON.stringify(s))})));case 8:case"end":return n.stop()}}),n)})))()})),Object(P["a"])(D,a["ROOMS_LIST_FETCH"],(function(e){return Object(U["a"])(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e.commit,n(a["ROOMS_IS_LOADING_SET"],!0),t.prev=2,t.next=5,Q.getRooms();case 5:r=t.sent,n(a["ROOMS_SET"],r.map((function(e){return Object(c["a"])(Object(c["a"])({},e),{},{count:0})})));case 7:return t.prev=7,n(a["ROOMS_IS_LOADING_SET"],!1),t.finish(7);case 10:case"end":return t.stop()}}),t,null,[[2,,7,10]])})))()})),Object(P["a"])(D,a["MESSAGES_FETCH"],(function(e,t){return Object(U["a"])(regeneratorRuntime.mark((function n(){var r,o;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r=e.commit,r(a["MESSAGES_IS_LOADING_SET"],!0),n.prev=2,n.next=5,Q.getRoomHistory(t);case 5:o=n.sent,r(a["MESSAGES_SET"],o),n.next=14;break;case 9:throw n.prev=9,n.t0=n["catch"](2),404===n.t0.response.status&&ie.push({name:"default"}),console.log(n.t0.response),n.t0;case 14:return n.prev=14,r(a["MESSAGES_IS_LOADING_SET"],!1),n.finish(14);case 17:case"end":return n.stop()}}),n,null,[[2,9,14,17]])})))()})),D),Y=n("b166"),Z=n("e3ee"),ee=n("1212"),te=(F={},Object(P["a"])(F,a["MESSAGES_GET"],(function(e){return e.messages.map((function(e){return Object(c["a"])(Object(c["a"])({},e),{},{createdFormatted:Object(Y["a"])(Object(Z["a"])(e.created),"dd.MM.yyyy HH:mm:ss")})}))})),Object(P["a"])(F,a["MESSAGES_SENDING_FILTRED_GET"],(function(e){return e.messagesSending.filter((function(t){return t.room===e.currentRoom}))})),Object(P["a"])(F,a["ROOMS_SORTED_GET"],(function(e){return Object(K["a"])(e.rooms).sort((function(e,t){return Object(ee["a"])(Object(Z["a"])(e.last_message.created),Object(Z["a"])(t.last_message.created))?-1:1})).map((function(e){return Object(c["a"])(Object(c["a"])({},e),{},{last_message:Object(c["a"])(Object(c["a"])({},e.last_message),{},{createdFormatted:Object(Y["a"])(Object(Z["a"])(e.last_message.created),"dd.MM.yyyy HH:mm:ss")})})}))})),F);r["a"].use(u["a"]);var ne=new u["a"].Store({state:{login:null,messageSocket:null,isSocketError:!1,isRoomsLoading:!1,rooms:[],currentRoom:null,isMessagesLoading:!1,messages:[],messagesSending:[]},actions:X,mutations:H,getters:te,modules:{},plugins:[Object(V["a"])({reducer:function(e){return{login:e.login}}})]}),re=n("8c4f");r["a"].use(re["a"]);var ae=[{path:"/",name:"default",meta:{authRequired:!1},component:function(){return Promise.all([n.e("Empty~about"),n.e("Empty")]).then(n.bind(null,"2c1e"))},children:[{path:"login",name:"Login",meta:{authRequired:!1},component:function(){return Promise.all([n.e("Login~New~about"),n.e("Login")]).then(n.bind(null,"a55b"))}},{path:"new",name:"New",meta:{authRequired:!0},component:function(){return Promise.all([n.e("Login~New~about"),n.e("New")]).then(n.bind(null,"67bf"))}}]},{path:"/:name",name:"Chat",meta:{authRequired:!0},component:function(){return Promise.all([n.e("Login~New~about"),n.e("Empty~about"),n.e("about")]).then(n.bind(null,"293a"))}}],oe=new re["a"]({routes:ae});oe.beforeEach((function(e,t,n){var r=e.matched.some((function(e){return e.meta.authRequired})),a=ne.state.login;r?a?n():n(!1):n()}));var ie=oe,ce=n("f309");r["a"].use(ce["a"]);var ue=new ce["a"]({});r["a"].prototype.$types=a,r["a"].config.productionTip=!1,new r["a"]({router:ie,store:ne,vuetify:ue,render:function(e){return e(k)}}).$mount("#app")},"6e87":function(e,t,n){"use strict";n.r(t),n.d(t,"LOGIN",(function(){return r})),n.d(t,"LOGOUT",(function(){return a})),n.d(t,"INIT_CONNECT",(function(){return o})),n.d(t,"ROOMS_LIST_FETCH",(function(){return i})),n.d(t,"ROOM_INFO_FETCH",(function(){return c})),n.d(t,"MESSAGE_SEND",(function(){return u})),n.d(t,"MESSAGES_FETCH",(function(){return s})),n.d(t,"LOGIN_SET",(function(){return m})),n.d(t,"SOCKET_SET",(function(){return l})),n.d(t,"SOCKET_ERROR_SET",(function(){return d})),n.d(t,"ROOMS_SET",(function(){return S})),n.d(t,"ROOMS_IS_LOADING_SET",(function(){return p})),n.d(t,"ROOM_CURRENT_SET",(function(){return E})),n.d(t,"MESSAGES_SET",(function(){return f})),n.d(t,"MESSAGES_IS_LOADING_SET",(function(){return O})),n.d(t,"MESSAGES_SENDING_SET",(function(){return _})),n.d(t,"MESSAGES_GET",(function(){return b})),n.d(t,"MESSAGES_SENDING_FILTRED_GET",(function(){return g})),n.d(t,"ROOMS_SORTED_GET",(function(){return v}));var r="LOGIN",a="LOGOUT",o="INIT_CONNECT",i="ROOMS_LIST_FETCH",c="ROOM_INFO_FETCH",u="MESSAGE_SEND",s="MESSAGES_FETCH",m="LOGIN_SET",l="SOCKET_SET",d="SOCKET_ERROR_SET",S="ROOMS_SET",p="ROOMS_IS_LOADING_SET",E="ROOM_CURRENT_SET",f="MESSAGES_SET",O="MESSAGES_IS_LOADING_SET",_="MESSAGES_SENDING_SET",b="MESSAGES_GET",g="MESSAGES_SENDING_FILTRED_GET",v="ROOMS_SORTED_GET"}});
//# sourceMappingURL=app.1d8f1fab.js.map